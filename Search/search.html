<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Results - Nike VN (Clone)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @tailwind base;
        @tailwind components;
        @tailwind utilities;
        
        /* Custom Checkbox Style */
        .custom-checkbox:checked + div {
            background-color: black;
            border-color: black;
        }
        .custom-checkbox:checked + div svg {
            display: block;
        }
        
        /* Hiệu ứng hover cho thẻ sản phẩm */
        .product-card:hover .card-img-wrap img {
            opacity: 0.9;
        }
    </style>
</head>
<body class="font-sans antialiased text-gray-900 bg-white">
    
    <div class="bg-black text-white text-xs md:text-sm py-2 px-4 text-center">
        New Styles On Sale: Up To 40% Off <a href="#" class="underline font-medium ml-1">Shop Now</a>
    </div>

    <nav class="sticky top-0 z-50 bg-white border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <a href="../home/home.html" class="flex-shrink-0">
                    <img src="../img/logo.png" alt="Nike Logo" class="h-6 md:h-[60px] object-contain">
                </a>

                <div class="hidden md:flex md:items-center md:space-x-6">
                    <a href="#" class="text-gray-800 hover:text-black font-medium text-sm">New & Featured</a>
                    <a href="#" class="text-gray-800 hover:text-black font-medium text-sm">Men</a>
                    <a href="#" class="text-gray-800 hover:text-black font-medium text-sm">Women</a>
                    <a href="#" class="text-gray-800 hover:text-black font-medium text-sm">Kids</a>
                    <a href="#" class="text-gray-800 hover:text-black font-medium text-sm">Sale</a>
                </div>

                <div class="flex items-center space-x-4">
                    <div class="relative hidden md:block">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <svg class="h-4 w-4 text-gray-900" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                            </svg>
                        </div>
                        <input type="text" 
                               id="searchInput"
                               class="bg-gray-100 rounded-full py-2 pl-10 pr-4 text-sm w-48 focus:outline-none focus:ring-1 focus:ring-gray-300 transition-all focus:w-64" 
                               placeholder="Search by Name or ID">
                    </div>
                    
                    <a href="../favor/favor.html" class="text-gray-600 hover:text-gray-900">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                        </svg>
                    </a>
                    
                    <a href="#" class="text-gray-600 hover:text-gray-900">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path>
                        </svg>
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-[1400px] mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <div class="flex flex-col md:flex-row md:items-center justify-between mb-6 sticky top-16 bg-white z-10 py-2">
            <h1 id="resultsTitle" class="text-xl md:text-2xl font-medium">Search results</h1>
            
            <div class="flex items-center space-x-4 mt-4 md:mt-0">
                <button class="flex items-center text-gray-600 hover:text-black lg:hidden">
                    <span class="mr-2">Filter</span>
                    <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"></path></svg>
                </button>
                <div class="relative group">
                    <button id="sortButton" class="flex items-center text-gray-800 font-medium">
                        Sort By <svg class="ml-1 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                    <div class="absolute right-0 mt-2 w-40 bg-white border border-gray-100 rounded-md shadow-lg hidden group-hover:block z-20">
                        <div class="py-1">
                            <button onclick="handleSort('featured')" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Featured</button>
                            <button onclick="handleSort('newest')" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Newest</button>
                            <button onclick="handleSort('price-desc')" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Price: High-Low</button>
                            <button onclick="handleSort('price-asc')" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Price: Low-High</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="flex">
            <aside class="w-60 flex-shrink-0 hidden lg:block pr-8 h-[calc(100vh-150px)] overflow-y-auto sticky top-32 scrollbar-hide">
                
                <div class="border-t border-gray-200 py-4">
                    <h3 class="font-medium text-sm mb-3">Gender</h3>
                    <div class="space-y-2">
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" value="Men" class="custom-checkbox hidden filter-gender" onchange="applyFilters()">
                            <div class="w-5 h-5 border border-gray-300 rounded flex items-center justify-center mr-2">
                                <svg class="w-3 h-3 text-white hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>
                            </div>
                            <span class="text-sm hover:text-gray-600">Men</span>
                        </label>
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" value="Women" class="custom-checkbox hidden filter-gender" onchange="applyFilters()">
                            <div class="w-5 h-5 border border-gray-300 rounded flex items-center justify-center mr-2">
                                <svg class="w-3 h-3 text-white hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>
                            </div>
                            <span class="text-sm hover:text-gray-600">Women</span>
                        </label>
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" value="Unisex" class="custom-checkbox hidden filter-gender" onchange="applyFilters()">
                            <div class="w-5 h-5 border border-gray-300 rounded flex items-center justify-center mr-2">
                                <svg class="w-3 h-3 text-white hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>
                            </div>
                            <span class="text-sm hover:text-gray-600">Unisex</span>
                        </label>
                    </div>
                </div>

                <div class="border-t border-gray-200 py-4">
                    <h3 class="font-medium text-sm mb-3">Shop By Price</h3>
                    <div class="space-y-2">
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" value="under2m" class="custom-checkbox hidden filter-price" onchange="applyFilters()">
                            <div class="w-5 h-5 border border-gray-300 rounded flex items-center justify-center mr-2">
                                <svg class="w-3 h-3 text-white hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>
                            </div>
                            <span class="text-sm hover:text-gray-600">Under 2.000.000₫</span>
                        </label>
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" value="2m-5m" class="custom-checkbox hidden filter-price" onchange="applyFilters()">
                            <div class="w-5 h-5 border border-gray-300 rounded flex items-center justify-center mr-2">
                                <svg class="w-3 h-3 text-white hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>
                            </div>
                            <span class="text-sm hover:text-gray-600">2.000.000₫ - 5.000.000₫</span>
                        </label>
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" value="over5m" class="custom-checkbox hidden filter-price" onchange="applyFilters()">
                            <div class="w-5 h-5 border border-gray-300 rounded flex items-center justify-center mr-2">
                                <svg class="w-3 h-3 text-white hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>
                            </div>
                            <span class="text-sm hover:text-gray-600">Over 5.000.000₫</span>
                        </label>
                    </div>
                </div>
            </aside>

            <main class="flex-1">
                <div id="productGrid" class="grid grid-cols-2 md:grid-cols-3 gap-4">
                    </div>
                
                <div class="border-t border-gray-200 mt-12 py-8">
                   <div class="text-center">
                        <h4 class="font-medium text-lg mb-4">Related Categories</h4>
                        <div class="flex flex-wrap justify-center gap-2">
                            <a href="#" class="px-4 py-2 border border-gray-300 rounded-full text-sm hover:border-black transition">Air Max Shoes</a>
                            <a href="#" class="px-4 py-2 border border-gray-300 rounded-full text-sm hover:border-black transition">Running Shoes</a>
                            <a href="#" class="px-4 py-2 border border-gray-300 rounded-full text-sm hover:border-black transition">Jordan</a>
                        </div>
                   </div>
                </div>
            </main>
        </div>
    </div>

    <footer class="bg-black text-white py-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="font-bold text-lg mb-4">Find A Store</h3>
                    <ul class="space-y-2 text-gray-400">
                        <li><a href="#" class="hover:text-white">Become a Member</a></li>
                        <li><a href="#" class="hover:text-white">Sign Up for Email</a></li>
                        <li><a href="#" class="hover:text-white">Student Discounts</a></li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="font-bold text-lg mb-4">Get Help</h3>
                    <ul class="space-y-2 text-gray-400">
                        <li><a href="#" class="hover:text-white">Order Status</a></li>
                        <li><a href="#" class="hover:text-white">Delivery</a></li>
                        <li><a href="#" class="hover:text-white">Returns</a></li>
                        <li><a href="#" class="hover:text-white">Payment Options</a></li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="font-bold text-lg mb-4">About Us</h3>
                    <ul class="space-y-2 text-gray-400">
                        <li><a href="#" class="hover:text-white">News</a></li>
                        <li><a href="#" class="hover:text-white">Careers</a></li>
                        <li><a href="#" class="hover:text-white">Investors</a></li>
                        <li><a href="#" class="hover:text-white">Sustainability</a></li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="font-bold text-lg mb-4">Follow Us</h3>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-400 hover:text-white">
                            <span class="sr-only">Facebook</span>
                            <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.988C18.343 21.128 22 16.991 22 12z" clip-rule="evenodd" /></svg>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white">
                            <span class="sr-only">Instagram</span>
                            <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M12.315 2c2.43 0 2.784.013 3.808.06 1.064.049 1.791.218 2.427.465a4.902 4.902 0 011.772 1.153 4.902 4.902 0 011.153 1.772c.247.636.416 1.363.465 2.427.048 1.067.06 1.407.06 4.123v.08c0 2.643-.012 2.987-.06 4.043-.049 1.064-.218 1.791-.465 2.427a4.902 4.902 0 01-1.153 1.772 4.902 4.902 0 01-1.772 1.153c-.636.247-1.363.416-2.427.465-1.067.048-1.407.06-4.123.06h-.08c-2.643 0-2.987-.012-4.043-.06-1.064-.049-1.791-.218-2.427-.465a4.902 4.902 0 01-1.772-1.153 4.902 4.902 0 01-1.153-1.772c-.247-.636-.416-1.363-.465-2.427-.047-1.024-.06-1.379-.06-3.808v-.63c0-2.43.013-2.784.06-3.808.049-1.064.218-1.791.465-2.427a4.902 4.902 0 011.153-1.772A4.902 4.902 0 015.45 2.525c.636-.247 1.363-.416 2.427-.465C8.901 2.013 9.256 2 11.685 2h.63zm-.081 1.802h-.468c-2.456 0-2.784.011-3.807.058-.975.045-1.504.207-1.857.344-.467.182-.8.398-1.15.748-.35.35-.566.683-.748 1.15-.137.353-.3.882-.344 1.857-.047 1.023-.058 1.351-.058 3.807v.468c0 2.456.011 2.784.058 3.807.045.975.207 1.504.344 1.857.182.466.399.8.748 1.15.35.35.683.566 1.15.748.353.137.882.3 1.857.344 1.054.048 1.37.058 4.041.058h.08c2.597 0 2.917-.01 3.96-.058.976-.045 1.505-.207 1.858-.344.466-.182.8-.398 1.15-.748.35-.35.566-.683.748-1.15.137-.353.3-.882.344-1.857.048-1.055.058-1.37.058-4.041v-.08c0-2.597-.01-2.917-.058-3.96-.045-.976-.207-1.505-.344-1.858a3.097 3.097 0 00-.748-1.15 3.098 3.098 0 00-1.15-.748c-.353-.137-.882-.3-1.857-.344-1.023-.047-1.351-.058-3.807-.058zM12 6.865a5.135 5.135 0 110 10.27 5.135 5.135 0 010-10.27zm0 1.802a3.333 3.333 0 100 6.666 3.333 3.333 0 000-6.666zm5.338-3.205a1.2 1.2 0 110 2.4 1.2 1.2 0 010-2.4z" clip-rule="evenodd" /></svg>
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="mt-10 pt-6 border-t border-gray-800 text-center text-gray-400 text-sm">
                <p>© 2023 SGD, Inc. All Rights Reserved</p>
                <div class="mt-2">
                    <a href="#" class="hover:text-white mx-2">Guides</a>
                    <a href="#" class="hover:text-white mx-2">Terms of Sale</a>
                    <a href="#" class="hover:text-white mx-2">Terms of Use</a>
                    <a href="#" class="hover:text-white mx-2">Privacy Policy</a>
                </div>
            </div>
        </div>
    </footer>

    <script src="../home/mockupdata.js"></script>

    <script>
        //--- QUẢN LÝ TRẠNG THÁI (STATE) ---
        let currentFilters = {
            search: "",
            genders: [],
            prices: [],
            sortBy: "featured" // default
        };

        //Lấy các element cần thiết
        const searchInput = document.getElementById('searchInput');
        const productGrid = document.getElementById('productGrid');
        const resultsTitle = document.getElementById('resultsTitle');

        // --- HÀM TIỆN ÍCH ---
        // --- Dùng chung logic tim với Home ---
        function getFavorites() {
            return JSON.parse(localStorage.getItem('nikeFavorites')) || [];
        }

        function toggleLike(btn, productId) {
            event.stopPropagation();
            let favorites = getFavorites();
            const icon = btn.querySelector('svg');
        
            if (favorites.includes(productId)) {
                favorites = favorites.filter(id => id !== productId);
                icon.classList.remove('text-pink-500', 'fill-current');
                icon.classList.add('text-gray-500'); // White/Gray state
            } else {
                favorites.push(productId);
                icon.classList.remove('text-gray-500');
                icon.classList.add('text-pink-500', 'fill-current'); // Pink state
                btn.classList.add('scale-125');
                setTimeout(() => btn.classList.remove('scale-125'), 200);
            }
            localStorage.setItem('nikeFavorites', JSON.stringify(favorites));
        }
        
        // Chuyển đổi giá tiền từ string "3.209.000₫" sang số 3209000
        function parsePrice(priceStr) {
            return parseInt(priceStr.replace(/[^\d]/g, ''));
        }

        //Hàm render sản phẩm ra màn hình
        function renderProducts(items) {
            const productGrid = document.getElementById('productGrid');
            productGrid.innerHTML = '';

            if (items.length === 0) {
                productGrid.innerHTML = `<div class="col-span-full text-center py-20"><p class="text-xl text-gray-600">No results found.</p></div>`;
                return;
            }

            // Lấy danh sách tim hiện tại
            const favorites = getFavorites();

            items.forEach(product => {
                // Kiểm tra trạng thái tim
                const isLiked = favorites.includes(product.id);
                const heartClass = isLiked ? 'text-pink-500 fill-current' : 'text-gray-500';

                const html = `
                    <div class="product-card group cursor-pointer relative">
                        <div class="card-img-wrap bg-[#f5f5f5] aspect-square mb-2 relative rounded-lg overflow-hidden">
                            <img src="${product.image}" alt="${product.name}" class="w-full h-full object-contain mix-blend-multiply transition-opacity duration-300">
                        
                            <button onclick="toggleLike(this, ${product.id})" 
                                    class="absolute top-2 right-2 bg-white p-2 rounded-full shadow-sm hover:bg-gray-100 transition-all z-10 opacity-100 md:opacity-0 md:group-hover:opacity-100">
                                <svg class="w-5 h-5 ${heartClass}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                                </svg>
                            </button>
                        </div>
                        <div class="px-1">
                            <h3 class="font-medium text-black text-base">${product.name}</h3>
                            <p class="text-gray-500 text-sm">${product.category}</p>
                            <div class="mt-2 font-medium text-black">${product.price}</div>
                        </div>
                    </div>
            `   ;
                productGrid.innerHTML += html;
            });
        
            // Cập nhật tiêu đề kết quả (giữ nguyên logic cũ)
            const resultsTitle = document.getElementById('resultsTitle');
            if(resultsTitle) resultsTitle.innerText = `Search results (${items.length})`;
        }

        // 3. LOGIC LỌC CHÍNH (Đã sửa phần Gender)
        function applyFilters() {
            // A. Lấy giá trị input
            currentFilters.search = document.getElementById('searchInput').value.toLowerCase();
            currentFilters.genders = Array.from(document.querySelectorAll('.filter-gender:checked')).map(cb => cb.value);
            currentFilters.prices = Array.from(document.querySelectorAll('.filter-price:checked')).map(cb => cb.value);

            // B. Lọc
            let filtered = products.filter(product => {
                // 1. Search
                const matchSearch = product.name.toLowerCase().includes(currentFilters.search) || 
                                    product.id.toString() === currentFilters.search;
                if (!matchSearch) return false;

                // 2. Gender (Sửa lỗi tại đây)
                if (currentFilters.genders.length > 0) {
                    // Logic: Lặp qua các gender đã chọn (Ví dụ: "Men")
                    // Kiểm tra xem category của sản phẩm (Ví dụ: "Men's Shoes") có CHỨA từ đó không
                    
                    const category = product.category || ""; // Lấy category, nếu không có thì là chuỗi rỗng
                    
                    // Chỉ cần sản phẩm khớp với 1 trong các ô được check là lấy (Logic OR)
                    const matchGender = currentFilters.genders.some(selectedGender => {
                        return category.includes(selectedGender); 
                    });
                    
                    if (!matchGender) return false;
                }

                // 3. Price
                if (currentFilters.prices.length > 0) {
                    const priceVal = parsePrice(product.price);
                    let matchPrice = false;
                    currentFilters.prices.forEach(range => {
                        if (range === 'under2m' && priceVal < 2000000) matchPrice = true;
                        if (range === '2m-5m' && priceVal >= 2000000 && priceVal <= 5000000) matchPrice = true;
                        if (range === 'over5m' && priceVal > 5000000) matchPrice = true;
                    });
                    if (!matchPrice) return false;
                }

                return true;
            });

            // C. Sort
            if (currentFilters.sortBy === 'price-asc') {
                filtered.sort((a, b) => parsePrice(a.price) - parsePrice(b.price));
            } else if (currentFilters.sortBy === 'price-desc') {
                filtered.sort((a, b) => parsePrice(b.price) - parsePrice(a.price));
            } else if (currentFilters.sortBy === 'newest') {
                filtered.sort((a, b) => b.id - a.id);
            }

            renderProducts(filtered);
        }

        // 4. EVENTS
        document.getElementById('searchInput').addEventListener('keyup', applyFilters);

        function handleSort(sortType) {
            currentFilters.sortBy = sortType;
            const mapName = {
                'featured': 'Featured',
                'newest': 'Newest',
                'price-desc': 'Price: High-Low',
                'price-asc': 'Price: Low-High'
            };
            document.getElementById('sortButton').innerHTML = 
                `Sort By: ${mapName[sortType]} <svg class="ml-1 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>`;
            applyFilters();
        }

        // 5. INIT
        document.addEventListener('DOMContentLoaded', () => {
            renderProducts(products);
        });
    </script>
</body>
</html>